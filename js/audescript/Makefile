audescript.js: main.js utils.js lexer.js lexer.identifier.js internals.js types.js handle-operators.js js-features.js parse-statement-after.js runtime.js destruct.js foreach.js parse-statement.js
	@echo "// PLEASE DO NOT EDIT THIS FILE DIRECTLY. IT IS AUTOMATICALLY GENERATED BY A MAKEFILE." > audescript.js.part ; \
	if [ "$$SKIP_TESTS" != "" ] || [ "`which eslint`" = "" ]; then \
		echo "Skipping eslint tests"; \
		eslint () { \
			exit 0; \
		}; \
	fi; \
	for i in $^ ; do \
		lint=`eslint $$i`; \
		if [ "$$lint" != "" ]; then \
			printf "\033[31m\033[1mSorry, '$$i' doesn't lint:\033[21m\033[0m\n"; \
			eslint $$i; \
			exit 1; \
		fi ; \
		if [ "$$i" = "main.js" ]; then \
			begining=1; \
		else \
			begining=`grep '"use strict";' -n -m 1 $$i | cut -d: -f1`; \
			begining=$$((begining+1)); \
		fi ; \
		tail -n +$$begining $$i | head -n -1 | grep -v "// removed in audescript.js" | sed 's,// added in audescript.js: ,,g' >> audescript.js.part; \
	done ; \
	tail -n 1 main.js >> audescript.js.part; \
	lint=`eslint audescript.js.part`; \
	if [ "$$lint" != "" ]; then \
		printf "\033[31m\033[1mSorry, the 'audescript.js' concatenation result doesn't lint:\033[21m\033[0m\n"; \
		eslint audescript.js.part; \
		exit 1; \
	fi ;\
	mv audescript.js.part audescript.js;
clean:
	rm -f audescript.js audescript.js.part
